using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using RubezhAPI;
using RubezhAPI.License;

namespace GKWebService.Models.GK
{
	public class GKModuleLoader
	{
		NavigationItem zonesNavigationItem;
		NavigationItem guardZonesNavigationItem;
		NavigationItem skdZonesNavigationItem;
		NavigationItem directionsNavigationItem;
		NavigationItem delaysNavigationItem;
		NavigationItem pimsNavigationItem;
		NavigationItem pumpStationsNavigationItem;
		NavigationItem mptsNavigationItem;
		NavigationItem doorsNavigationItem;

		public IEnumerable<NavigationItem> CreateNavigation()
		{
			zonesNavigationItem = new NavigationItem("Пожарные зоны", "firezones", "fireZones", "fireZones({uid: ''})");
			guardZonesNavigationItem = new NavigationItem("Охранные зоны", "firezones", "guardZone", "guardZone({uid: ''})");
			directionsNavigationItem = new NavigationItem("Направления", "directions", "directions", "directions({uid: ''})");
			delaysNavigationItem = new NavigationItem("Задержки", "delays", "delays", "delays({uid: ''})");
			pumpStationsNavigationItem = new NavigationItem("НС", "pumpStation", "pumpStations", "pumpStations({uid: ''})");
			mptsNavigationItem = new NavigationItem("МПТ", "mpt", "MPTs", "MPTs({uid: ''})");
			doorsNavigationItem = new NavigationItem("Точки доступа", "doors", "doors", "doors({uid: ''})");

			return new List<NavigationItem>
					{
						new NavigationItem("Состояния", "state", "state", "state({alarmType: ''})"),
						new NavigationItem("Устройства", "device", "device", "device({uid: ''})"),
						new NavigationItem("Параметры", "params", "params", "params({uid: ''})"),
						zonesNavigationItem,
						guardZonesNavigationItem,
						directionsNavigationItem,
						delaysNavigationItem,
						pumpStationsNavigationItem,
						mptsNavigationItem,
						doorsNavigationItem,
					};
		}

		public void Initialize()
		{
			zonesNavigationItem.IsVisible = GKManager.Zones.Count > 0;
			guardZonesNavigationItem.IsVisible = GKManager.DeviceConfiguration.GuardZones.Count > 0;
			//skdZonesNavigationItem.IsVisible = LicenseManager.CurrentLicenseInfo.HasSKD && GKManager.DeviceConfiguration.SKDZones.Count > 0;
			directionsNavigationItem.IsVisible = GKManager.Directions.Count > 0;
			pumpStationsNavigationItem.IsVisible = GKManager.PumpStations.Count > 0;
			mptsNavigationItem.IsVisible = GKManager.MPTs.Count > 0;
			delaysNavigationItem.IsVisible = GKManager.Delays.Any(d => !d.IsAutoGenerated);
			//pimsNavigationItem.IsVisible = PimsViewModel.Pims.Count > 0;
			doorsNavigationItem.IsVisible = GKManager.Doors.Count > 0;
		}
	}
}