<UserControl
	x:Class="StrazhService.Monitor.Views.MainView"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:views="clr-namespace:StrazhService.Monitor.Views"
	xmlns:converters="clr-namespace:StrazhService.Monitor.Converters"
	xmlns:lang="clr-namespace:Localization.StrazhService.Monitor.Views;assembly=Localization"
	MinWidth="400"
	MinHeight="400"
	Loaded="UserControl_Loaded">
	<UserControl.Resources>
		<ResourceDictionary>
			<converters:StringsToLastStringConverter x:Key="StringsToLastStringConverter"/>
		</ResourceDictionary>
	</UserControl.Resources>
	<Grid Margin="10">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto" />
			<RowDefinition Height="*" />
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>
		<Grid>
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="Auto"/>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="Auto"/>
			</Grid.ColumnDefinitions>
			<views:ServiceControlView
				Grid.Column="0"
				DataContext="{Binding ServiceControlViewModel}" />
			<TextBlock
				Grid.Column="1"
				Visibility="{Binding HasLicense, Converter={StaticResource InversedBoolToVisibilityConverter}}"
				Text="{x:Static lang:CommonViews.NoLicense}"
				Foreground="{DynamicResource ForegroundColorLight}"
				HorizontalAlignment="Right"
				VerticalAlignment="Center"
				Margin="2"/>
			<views:ServiceStateView
				Grid.Column="2"
				DataContext="{Binding ServiceStateViewModel}"
				Margin="5"/>
		</Grid>
		<TabControl Grid.Row="1" Background="{DynamicResource AlternativeBackgroundBrush}">
			<TabItem Header="{x:Static lang:CommonViews.Connections}">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="*"/>
						<RowDefinition Height="Auto"/>
					</Grid.RowDefinitions>
					<DataGrid Grid.Row="0" ItemsSource="{Binding Clients}" SelectedItem="{Binding SelectedClient}">
						<DataGrid.Columns>
							<DataGridTemplateColumn>
								<DataGridTemplateColumn.CellTemplate>
									<DataTemplate>
										<StackPanel Orientation="Horizontal">
											<CheckBox IsChecked="{Binding IsChecked, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" IsEnabled="{Binding CanCheck}" Margin="2 0 2 0" />
											<!--<TextBlock Text="{Binding UID}"/>-->
										</StackPanel>
									</DataTemplate>
								</DataGridTemplateColumn.CellTemplate>
							</DataGridTemplateColumn>
							<DataGridTextColumn Binding="{Binding ClientType}" Header="{x:Static lang:CommonViews.Type}" />
							<DataGridTextColumn Binding="{Binding IpAddress}" Header="{x:Static lang:CommonViews.Address}" />
							<DataGridTextColumn Width="*" Binding="{Binding FriendlyUserName}" Header="{x:Static lang:CommonViews.User}" />
						</DataGrid.Columns>
					</DataGrid>
					<Button Grid.Row="1" Content="{x:Static lang:CommonViews.RefuseConnection}" Command="{Binding ReleaseClientsCommand}" Width="150" HorizontalAlignment="Right" Margin="5"/>
				</Grid>
			</TabItem>
			<TabItem Header="{x:Static lang:CommonViews.Settings}">
				<views:AppServerSettingsView DataContext="{Binding AppServerSettingsViewModel}"/>
			</TabItem>
			<TabItem Header="{x:Static lang:CommonViews.DataBase}">
				<views:DatabaseSettingsView DataContext="{Binding DatabaseSettingsViewModel}"/>
			</TabItem>
			<TabItem Header="{x:Static lang:CommonViews.Log}">
				<views:LogsView DataContext="{Binding LogsViewModel}"/>
			</TabItem>
			<TabItem Header="{x:Static lang:CommonViews.Licensing}">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition />
						<RowDefinition Height="Auto" />
					</Grid.RowDefinitions>
					<StackPanel Orientation="Horizontal">
						<TextBlock
							Text="{x:Static lang:CommonViews.LicenseStatus}"
							Foreground="White"
							VerticalAlignment="Center"
							Margin="5"/>
						<TextBlock
							Text="{Binding LicenseStatusText, FallbackValue={x:Static lang:CommonViews.NoLicense}}"
							Foreground="White"
							VerticalAlignment="Center"
							Margin="5"/>
					</StackPanel>
					<DataGrid
						Grid.Row="1"
						HeadersVisibility="None"
						ItemsSource="{Binding LicenseItems, IsAsync=True}">
						<DataGrid.Columns>
							<DataGridTemplateColumn Width="Auto">
								<DataGridTemplateColumn.CellTemplate>
									<DataTemplate>
										<TextBlock
											Text="{Binding Key}"
											Margin="5 0"
											VerticalAlignment="Center"/>
									</DataTemplate>
								</DataGridTemplateColumn.CellTemplate>
							</DataGridTemplateColumn>
							<DataGridTemplateColumn Width="*">
								<DataGridTemplateColumn.CellTemplate>
									<DataTemplate>
										<TextBlock
											Text="{Binding Value}"
											Margin="5 0"
											VerticalAlignment="Center"/>
									</DataTemplate>
								</DataGridTemplateColumn.CellTemplate>
							</DataGridTemplateColumn>
						</DataGrid.Columns>
					</DataGrid>
					<Grid Grid.Row="2">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>
						<TextBlock
							Text="{x:Static lang:CommonViews.IDNumber}"
							Foreground="White"
							VerticalAlignment="Center"
							Margin="5"/>
						<TextBox
							Grid.Column="1"
							IsReadOnly="True"
							Text="{Binding UserKey, Mode=OneWay}"
							Margin="5"
							VerticalAlignment="Center" />
						<Button
							Grid.Column="2"
							Content="{x:Static lang:CommonViews.UploadLicense}"
							Command="{Binding LoadLicenseCommand}"
							VerticalAlignment="Center"
							Width="140"
							Margin="5"/>
					</Grid>
				</Grid>
			</TabItem>
		</TabControl>
		<TextBlock Grid.Row="2" Margin="5 0 0 0" FontSize="11" FontWeight="Bold" Foreground="Orange" Text="{Binding LogsViewModel.Log, Converter={StaticResource StringsToLastStringConverter}}" />
	</Grid>
</UserControl>