<UserControl
	x:Class="StrazhModule.Views.DevicesView"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:ListViewManager="clr-namespace:Controls.ListViewLayoutManager;assembly=Controls"
	xmlns:sys="clr-namespace:System;assembly=mscorlib"
	xmlns:tree="clr-namespace:Controls.TreeList;assembly=Controls"
	xmlns:viewModel="clr-namespace:StrazhModule.ViewModels"
	xmlns:scm="clr-namespace:System.ComponentModel;assembly=WindowsBase"
	xmlns:Views="clr-namespace:StrazhModule.Views">
	<UserControl.Resources>
		<viewModel:DeviceViewModelDeviceComparer x:Key="DeviceViewModelDeviceComparer" />
		<viewModel:DeviceViewModelAddressComparer x:Key="DeviceViewModelAddressComparer" />
		<viewModel:DeviceViewModelDoorTypeDescriptionComparer x:Key="DeviceViewModelDoorTypeDescriptionComparer" /> 
		<CollectionViewSource x:Key="cvsRootDevices" Source="{Binding RootDevices}">
			<CollectionViewSource.SortDescriptions>
				<scm:SortDescription PropertyName="PresentationAddress" />
			</CollectionViewSource.SortDescriptions>
		</CollectionViewSource>
	</UserControl.Resources>
	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="*" MinHeight="200" />
			<RowDefinition Height="Auto" />
			<RowDefinition Height="150" MinHeight="150" />
		</Grid.RowDefinitions>
		<Grid
			ScrollViewer.IsDeferredScrollingEnabled="True"
			VirtualizingStackPanel.VirtualizationMode="Recycling">
			<!-- Дерево устройств -->
			<tree:TreeList
				x:Name="_devicesDataGrid"
				Focusable="True"
				SelectedTreeNode="{Binding SelectedDevice}"
				ListViewManager:ListViewLayoutManager.Enabled="True"
				Source="{Binding Source={StaticResource cvsRootDevices}}"
				tree:SortBehavior.CanUserSortColumns="True"
				tree:SortBehavior.DefaultSortComparer="{StaticResource DeviceViewModelDeviceComparer}">
				<tree:TreeList.View>
					<GridView>
						<!-- Колонка "Устройство" -->
						<GridViewColumn
							Header="Устройство"
							Width="250"
							tree:SortBehavior.SortComparer="{StaticResource DeviceViewModelDeviceComparer}">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<Views:DeviceView />
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
						<!-- Колонка "Адрес" -->
						<GridViewColumn
							Width="100"
							DisplayMemberBinding="{Binding PresentationAddress}"
							Header="Адрес"
							tree:SortBehavior.SortComparer="{StaticResource DeviceViewModelAddressComparer}" />
						<!-- Колонка "Режим" -->
						<GridViewColumn
							Width="100"
							DisplayMemberBinding="{Binding DoorTypeDescription}"
							Header="Режим"
							tree:SortBehavior.SortComparer="{StaticResource DeviceViewModelDoorTypeDescriptionComparer}" />
						<!-- Колонка "Ведет в зону -->
						<GridViewColumn Header="Ведет в зону" ListViewManager:ProportionalColumn.Width="1">
							<GridViewColumn.CellTemplate>
								<DataTemplate>
									<TextBlock VerticalAlignment="Center" Visibility="{Binding HasZone, Converter={StaticResource BoolToVisibilityConverter}}">
										<Hyperlink Command="{Binding ShowZoneDetailsCommand}" Style="{StaticResource HyperlinkStyle2}">
											<StackPanel Orientation="Horizontal">
												<Image Width="16" Source="/Controls;component/Images/Zone.png" Margin="2 0" />
												<Image Source="{Binding Zone.State.StateClass, Converter={StaticResource XStateClassToIconConverter}}" Width="16" Height="16" VerticalAlignment="Center" Margin="2 0" />
												<TextBlock HorizontalAlignment="Stretch" Text="{Binding Zone.PresentationName}" ToolTip="{Binding Zone.PresentationName}" />
											</StackPanel>
										</Hyperlink>
									</TextBlock>
								</DataTemplate>
							</GridViewColumn.CellTemplate>
						</GridViewColumn>
					</GridView>
				</tree:TreeList.View>
			</tree:TreeList>
		</Grid>
		<GridSplitter Grid.Row="1" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Background="Transparent" Cursor="SizeNS" />
		<Border Grid.Row="2" Margin="0, 5, 0, 0" Background="{DynamicResource BackgroundBrush}" BorderThickness="0" CornerRadius="5" DataContext="{Binding SelectedDevice}" Padding="5" TextBlock.FontSize="11" TextBlock.Foreground="White">
			<ScrollViewer VerticalScrollBarVisibility="Auto">
				<StackPanel>
					<StackPanel Orientation="Horizontal" Margin="2">
						<Image Width="16" Height="16" Margin="2" VerticalAlignment="Center" Source="{Binding Device.Driver.ImageSource}" />
						<TextBlock Text="{Binding Device.Name}" FontWeight="Bold" Foreground="Orange" VerticalAlignment="Center" />
					</StackPanel>
					<Views:DeviceStateView TextElement.Foreground="White" Margin="2" />

					<WrapPanel Orientation="Horizontal" Visibility="{Binding HasDoor, Converter={StaticResource BoolToVisibilityConverter}}" Margin="2">
						<TextBlock VerticalAlignment="Center">
							<Hyperlink Command="{Binding ShowDoorCommand}" Style="{StaticResource HyperlinkStyle}">
								<StackPanel Orientation="Horizontal">
									<Image Width="16" Margin="2" Source="/Controls;component/Images/Door.png" />
									<TextBlock Text="{Binding Door.Name}" ToolTip="{Binding Door.Name}" TextWrapping="Wrap" VerticalAlignment="Center" Margin="1 0 0 0" />
								</StackPanel>
							</Hyperlink>
						</TextBlock>
					</WrapPanel>
				</StackPanel>
			</ScrollViewer>
		</Border>
	</Grid>
</UserControl>