<UserControl
	x:Class="JournalModule.Views.JournalView"
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:langCommon="clr-namespace:Localization.Journal.Common;assembly=Localization"
    xmlns:lang="clr-namespace:Localization.Journal.Views;assembly=Localization"
    Loaded="UserControl_Loaded"
	d:DesignHeight="350"
	d:DesignWidth="650"
	mc:Ignorable="d">

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="*" />
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>
		<StackPanel Visibility="Collapsed">
			<CheckBox
				Name="CheckBox_AdditionalColumns"
				Checked="CheckBox_AdditionalColumns_Checked"
				IsChecked="{Binding AdditionalColumnsChanged,
			                              Mode=OneWay}"
				Unchecked="CheckBox_AdditionalColumns_Checked" />
		</StackPanel>
		<DataGrid
			Name="dataGrid"
			ItemsSource="{Binding JournalItems, IsAsync=True}"
			SelectedItem="{Binding SelectedJournal}">
			<DataGrid.Columns>
				<DataGridTemplateColumn Width="150" Header="{x:Static langCommon:CommonResources.DeviceTime}">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<TextBlock
								Margin="5 2"
								VerticalAlignment="Center"
								Text="{Binding JournalItem.DeviceDateTime,
							                          Converter={StaticResource NullableTimeToStringConverter}}" />
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
                <DataGridTemplateColumn MinWidth="150" Header="{x:Static langCommon:CommonResources.SystemTime}">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<TextBlock
								Margin="5 2"
								VerticalAlignment="Center"
								Text="{Binding JournalItem.SystemDateTime,
							                          Converter={StaticResource TimeToStringConverter}}" />
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
                <DataGridTemplateColumn Width="*" Header="{x:Static langCommon:CommonResources.Name}">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal">
								<Image
									Width="16"
									Margin="5 2"
									VerticalAlignment="Center">
									<Image.Source>
										<MultiBinding Converter="{StaticResource XStateClassToIconConverter}">
											<Binding Path="StateClass" />
											<Binding Path="IsStateImage" />
										</MultiBinding>
									</Image.Source>
								</Image>
								<TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
							</StackPanel>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
                <DataGridTemplateColumn Width="*" Header="{x:Static lang:CommonViews.Specification}">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal">
								<TextBlock
									Margin="5 0 0 0"
									VerticalAlignment="Center"
									Text="{Binding Description}" />
								<StackPanel Orientation="Horizontal" Visibility="{Binding CanShowErrorCode, Converter={StaticResource BoolToVisibilityConverter}}">
									<TextBlock
										Margin="2 0 0 0"
										VerticalAlignment="Center"
										Text=":" />
									<TextBlock
										Margin="2 0 0 0"
										VerticalAlignment="Center"
										Text="{Binding JournalItem.ErrorCode,
									                          Converter={StaticResource EnumToDescriptionConverter}}" />
								</StackPanel>
							</StackPanel>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
                <DataGridTemplateColumn Width="150" Header="{x:Static langCommon:CommonResources.Object}">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal">
								<Image
									Width="16"
									Height="16"
									Margin="5 2"
									VerticalAlignment="Center"
									Source="{Binding ObjectImageSource}" />
								<TextBlock VerticalAlignment="Center" Background="{Binding IsExistsInConfig, Converter={StaticResource BoolToStringColorConverter}}">
									<Hyperlink
										Command="{Binding ShowObjectOrPlanCommand}"
										IsEnabled="{Binding IsExistsInConfig}"
										Style="{StaticResource HyperlinkStyle2}">
										<TextBlock Text="{Binding ObjectName}" />
									</Hyperlink>
								</TextBlock>
							</StackPanel>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
                <DataGridTemplateColumn Width="*" Header="{x:Static langCommon:CommonResources.User}">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<TextBlock Margin="5 0 0 0" Text="{Binding JournalItem.UserName}" />
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
                <DataGridTemplateColumn Width="*" Header="{x:Static langCommon:CommonResources.Subsystem}">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal">
								<Image
									Width="16"
									Margin="5 2"
									VerticalAlignment="Center"
									Source="{Binding JournalItem.JournalSubsystemType,
								                        Converter={StaticResource JournalSubsystemTypeToIconConverter}}" />
								<TextBlock VerticalAlignment="Center" Text="{Binding JournalItem.JournalSubsystemType, Converter={StaticResource EnumToDescriptionConverter}}" />
							</StackPanel>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
			</DataGrid.Columns>
			<DataGrid.RowStyle>
				<Style TargetType="{x:Type DataGridRow}">
					<Style.Setters>
						<Setter Property="ContextMenu">
							<Setter.Value>
								<ContextMenu>
									<IconedMenuItem
										Command="{Binding ShowOnPlanCommand}"
										ImageSource="BMap"
										Text="{x:Static lang:CommonViews.ShowOnPlan}" />
									<IconedMenuItem
										Command="{Binding ShowObjectCommand}"
										ImageSource="BTree"
										Text="{x:Static lang:CommonViews.Show}" />
									<IconedMenuItem
										Command="{Binding ShowPropertiesCommand}"
										ImageSource="BSettings"
										Text="{x:Static langCommon:CommonResources.Settings}" />
								</ContextMenu>
							</Setter.Value>
						</Setter>
					</Style.Setters>
				</Style>
			</DataGrid.RowStyle>
			<DataGrid.CellStyle>
				<Style TargetType="{x:Type DataGridCell}">
					<Style.Setters>
						<Setter Property="Template">
							<Setter.Value>
								<ControlTemplate TargetType="{x:Type DataGridCell}">
									<Border Background="{TemplateBinding Background}">
										<ContentPresenter VerticalAlignment="Center" />
									</Border>
								</ControlTemplate>
							</Setter.Value>
						</Setter>
						<Setter Property="Background" Value="{Binding StateClass, Converter={StaticResource XStateClassToColorConverter}}" />
					</Style.Setters>
					<Style.Triggers>
						<Trigger Property="IsSelected" Value="True">
							<Setter Property="Background" Value="{DynamicResource PressedBackgroundBrush}" />
							<Setter Property="Foreground" Value="White" />
						</Trigger>
					</Style.Triggers>
				</Style>
			</DataGrid.CellStyle>
		</DataGrid>
		<Border
			Grid.Row="1"
			Margin="0 5 0 0"
			Background="{DynamicResource BackgroundBrush}"
			CornerRadius="5"
			DataContext="{Binding SelectedJournal}"
			Padding="5"
			TextElement.Foreground="White">
			<Grid>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="*" />
					<ColumnDefinition Width="*" />
				</Grid.ColumnDefinitions>
				<Grid Grid.Column="0">
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="130" />
						<ColumnDefinition Width="Auto" />
					</Grid.ColumnDefinitions>
					<Grid.RowDefinitions>
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
						<RowDefinition Height="Auto" />
					</Grid.RowDefinitions>
					<TextBlock
						Grid.Row="0"
						Grid.Column="0"
						Margin="2"
						Text="{x:Static langCommon:CommonResources.SystemTime}" />
					<TextBlock
						Grid.Row="0"
						Grid.Column="1"
						Margin="2"
						Text="{Binding JournalItem.SystemDateTime,
					                          Converter={StaticResource TimeToStringConverter}}" />

					<TextBlock
						Grid.Row="1"
						Grid.Column="0"
						Margin="2"
						Text="{x:Static langCommon:CommonResources.DeviceTime}" />
					<TextBlock
						Grid.Row="1"
						Grid.Column="1"
						Margin="2"
						Text="{Binding JournalItem.DeviceDateTime,
					                          Converter={StaticResource NullableTimeToStringConverter}}" />

					<TextBlock
						Grid.Row="2"
						Grid.Column="0"
						Margin="2"
						Text="{x:Static lang:CommonViews.Event}" />
					<StackPanel
						Grid.Row="2"
						Grid.Column="1"
						Orientation="Horizontal">
						<Image
							Width="16"
							Margin="2 0"
							VerticalAlignment="Center">
							<Image.Source>
								<MultiBinding Converter="{StaticResource XStateClassToIconConverter}">
									<Binding Path="StateClass" />
									<Binding Path="IsStateImage" />
								</MultiBinding>
							</Image.Source>
						</Image>
						<TextBlock VerticalAlignment="Center" Text="{Binding Name}" />
					</StackPanel>

					<TextBlock
						Grid.Row="3"
						Grid.Column="0"
						Margin="2"
						Text="{x:Static lang:CommonViews.Specification}" />
					<TextBlock
						Grid.Row="3"
						Grid.Column="1"
						Margin="2"
						Text="{Binding Description}" />

					<TextBlock
						Grid.Row="4"
						Grid.Column="1"
						Margin="2"
						Text="{Binding JournalItem.ErrorCode,
					                          Converter={StaticResource EnumToDescriptionConverter}}"
						Visibility="{Binding CanShowErrorCode,
					                                Converter={StaticResource BoolToVisibilityConverter},
					                                ConverterParameter=True}" />

					<TextBlock
						Grid.Row="5"
						Grid.Column="0"
						Margin="2"
						Text="{x:Static langCommon:CommonResources.User}" />
					<TextBlock
						Grid.Row="5"
						Grid.Column="1"
						Margin="2"
						Text="{Binding JournalItem.UserName}" />

					<TextBlock
						Grid.Row="6"
						Grid.Column="0"
						Margin="2"
						Text="{x:Static langCommon:CommonResources.Subsystem}" />
					<StackPanel
						Grid.Row="6"
						Grid.Column="1"
						Orientation="Horizontal">
						<Image
							Width="16"
							Margin="2"
							VerticalAlignment="Center"
							Source="{Binding JournalItem.JournalSubsystemType,
						                        Converter={StaticResource JournalSubsystemTypeToIconConverter}}" />
						<TextBlock VerticalAlignment="Center" Text="{Binding JournalItem.JournalSubsystemType, Converter={StaticResource EnumToDescriptionConverter}}" />
					</StackPanel>
					<Button
						Grid.Row="7"
						Grid.Column="1"
						BorderBrush="#D8FFFFFF"
						Width="100"
						Margin="2"
						Command="{Binding ShowVideoCommand}"
						Content="{x:Static lang:CommonViews.ShowVideo}" />
				</Grid>
				<!--  Правая панель  -->
				<StackPanel Grid.Column="1">
					<ItemsControl ItemsSource="{Binding JournalItem.JournalDetalisationItems}">
						<ItemsControl.ItemTemplate>
							<DataTemplate>
								<StackPanel Orientation="Horizontal">
									<TextBlock
										Width="200"
										Margin="1"
										Text="{Binding Name}" />
									<TextBlock Margin="1" Text="{Binding Value}" />
								</StackPanel>
							</DataTemplate>
						</ItemsControl.ItemTemplate>
					</ItemsControl>
					<!--<StackPanel Orientation="Horizontal">
						<TextBlock Text="Расшифровка" Width="200" Margin="1"/>
						<TextBlock Text="{Binding JournalItem.ErrorCode, Converter={StaticResource EnumToDescriptionConverter}}" Margin="1"/>
					</StackPanel>-->

				</StackPanel>
			</Grid>
		</Border>
	</Grid>
</UserControl>