<UserControl x:Class="GKModule.Views.DoorsView" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:Controls="clr-namespace:Controls;assembly=Controls" xmlns:sys="clr-namespace:System;assembly=mscorlib" xmlns:tree="clr-namespace:Controls.TreeList;assembly=Controls" xmlns:viewModel="clr-namespace:GKModule.ViewModels" xmlns:Views="clr-namespace:GKModule.Views">

	<Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="*" />
			<RowDefinition Height="Auto" />
		</Grid.RowDefinitions>
		<Grid Grid.Row="0" ScrollViewer.IsDeferredScrollingEnabled="True" VirtualizingStackPanel.VirtualizationMode="Recycling">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*" />
				<ColumnDefinition Width="*" />
			</Grid.ColumnDefinitions>
			<DataGrid Grid.Column="0" CanUserSortColumns="True" Focusable="True" ItemsSource="{Binding Doors}" SelectedItem="{Binding SelectedDoor}">
			<DataGrid.Columns>
				<DataGridTemplateColumn Width="Auto" CanUserResize="False" Header="№" SortMemberPath="Door.No">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal">
								<Image Margin="1 0 0 0" VerticalAlignment="Center" Source="/Controls;component/Images/Door.png" />
								<TextBlock Margin="2 0 5 0" VerticalAlignment="Center" Text="{Binding Door.No}" />
							</StackPanel>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
				<DataGridTemplateColumn Width="*" Header="Точка доступа" SortMemberPath="Door.Name">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<StackPanel Orientation="Horizontal">
								<Image Width="16" Height="16" VerticalAlignment="Center" Source="{Binding State.StateClass, Converter={StaticResource XStateClassToIconConverter}}" />
								<TextBlock Width="200" Margin="2 0 0 0" HorizontalAlignment="Stretch" VerticalAlignment="Center">
									<Hyperlink Command="{Binding ShowOnPlanOrPropertiesCommand}" Style="{StaticResource HyperlinkStyle2}">
										<TextBlock Text="{Binding Door.Name}" />
									</Hyperlink>
									<TextBlock.ContextMenu>
										<ContextMenu>
											<IconedMenuItem Command="{Binding ShowOnPlanCommand}" ImageSource="BMap"  Text="Показать на плане" />
											<IconedMenuItem Command="{Binding ShowJournalCommand}" ImageSource="BJournal" Text="Показать связанные события" />
											<IconedMenuItem Command="{Binding ShowPropertiesCommand}" ImageSource="BSettings"  Text="Свойства" />
										</ContextMenu>
									</TextBlock.ContextMenu>
								</TextBlock>
								<StackPanel.InputBindings>
									<MouseBinding Command="{Binding ShowOnPlanCommand}" MouseAction="LeftDoubleClick" />
								</StackPanel.InputBindings>
								<StackPanel.ToolTip>
									<Views:DoorToolTipView />
								</StackPanel.ToolTip>
							</StackPanel>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
				<DataGridTextColumn Width="*" Binding="{Binding Door.Description}" Header="Примечание" />
				<DataGridTemplateColumn Width="*" Header="Устройство входа">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<TextBlock VerticalAlignment="Center" Visibility="{Binding HasEnterDevice, Converter={StaticResource BoolToVisibilityConverter}}">
								<Hyperlink Command="{Binding ShowEnterDeviceCommand}" Style="{StaticResource HyperlinkStyle2}">
									<StackPanel Orientation="Horizontal">
										<Image Width="16" Height="16" Margin="5 0" HorizontalAlignment="Left" Source="{Binding EnterDevice.Driver.ImageSource}" />
										<TextBlock HorizontalAlignment="Stretch" Text="{Binding EnterDevice.PresentationName}" ToolTip="{Binding EnterDevice.PresentationName}" />
									</StackPanel>
								</Hyperlink>
							</TextBlock>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
				<DataGridTemplateColumn Width="*" Header="Устройство выхода">
					<DataGridTemplateColumn.CellTemplate>
						<DataTemplate>
							<TextBlock VerticalAlignment="Center" Visibility="{Binding HasExitDevice, Converter={StaticResource BoolToVisibilityConverter}}">
								<Hyperlink Command="{Binding ShowExitDeviceCommand}" Style="{StaticResource HyperlinkStyle2}">
									<StackPanel Orientation="Horizontal">
										<Image Width="16" Height="16" Margin="5 0" HorizontalAlignment="Left" Source="{Binding ExitDevice.Driver.ImageSource}" />
										<TextBlock HorizontalAlignment="Stretch" Text="{Binding ExitDevice.PresentationName}" ToolTip="{Binding ExitDevice.PresentationName}" />
									</StackPanel>
								</Hyperlink>
							</TextBlock>
						</DataTemplate>
					</DataGridTemplateColumn.CellTemplate>
				</DataGridTemplateColumn>
			</DataGrid.Columns>
		</DataGrid>
			<DataGrid Grid.Column="1" ItemsSource="{Binding Devices}" DataContext="{Binding SelectedDoor}" Margin="4 0 0 0">
				<DataGrid.Resources>
					<InputBindingCollection x:Key="inputCollection" x:Shared="False">
						<MouseBinding Command="{Binding DataContext.SelectedPump.ShowPropertiesCommand, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=ItemsControl}}" MouseAction="LeftDoubleClick" />
					</InputBindingCollection>
				</DataGrid.Resources>
				<DataGrid.ItemContainerStyle>
					<Style BasedOn="{StaticResource {x:Type DataGridRow}}" TargetType="{x:Type DataGridRow}">
						<Setter Property="Controls:Attach.InputBindings" Value="{StaticResource inputCollection}" />
					</Style>
				</DataGrid.ItemContainerStyle>
				<DataGrid.Columns>
					<DataGridTemplateColumn Header="Устройства" MinWidth="150" Width="150">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<Views:DeviceView Margin="2 0" />
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>
					<DataGridTemplateColumn MinWidth="25" Header="Адрес">
						<DataGridTemplateColumn.CellTemplate>
							<DataTemplate>
								<TextBlock Text="{Binding Device.Address}" />
							</DataTemplate>
						</DataGridTemplateColumn.CellTemplate>
					</DataGridTemplateColumn>
					<DataGridTextColumn Binding="{Binding Device.Description}" Header="Описание" MinWidth="100" Width="*" />
				</DataGrid.Columns>
				<DataGrid.RowStyle>
					<Style TargetType="{x:Type DataGridRow}">
						<Setter Property="ToolTip">
							<Setter.Value>
								<StackPanel>
									<TextBlock Text="{Binding Device.PresentationName}" FontWeight="Bold" />
									<Views:DeviceStateView />
								</StackPanel>
							</Setter.Value>
						</Setter>
					</Style>
				</DataGrid.RowStyle>
			</DataGrid>
		</Grid>
		<Grid Grid.Row="1" DataContext="{Binding SelectedDoor}">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*" />
				<ColumnDefinition Width="*" />
			</Grid.ColumnDefinitions>
			<Border Grid.Column="0" CornerRadius="5" Background="White" MinHeight="100" Margin="0 4 0 0">
				<StackPanel Margin="2">
					<StackPanel Orientation="Horizontal">
						<TextBlock Text="Условие для режима всегда открыто" FontWeight="Bold" Width="250" Margin="5 2" />
						<TextBlock Text="{Binding OpenRegimeLogicName}" VerticalAlignment="Center" Margin="2" />
					</StackPanel>
					<StackPanel Orientation="Horizontal">
						<TextBlock Text="Условие для режима норма" FontWeight="Bold" Width="250" Margin="5 2" />
						<TextBlock Text="{Binding NormRegimeLogicName}" VerticalAlignment="Center" Margin="2" />
					</StackPanel>
					<StackPanel Orientation="Horizontal">
						<TextBlock Text="Условие для режима всегда закрыто" FontWeight="Bold" Width="250" Margin="5 2" />
						<TextBlock Text="{Binding CloseRegimeLogicName}" VerticalAlignment="Center" Margin="2" />
					</StackPanel>
				</StackPanel>
			</Border>
			<Views:DoorControlView Grid.Column="1" DataContext="{Binding DoorDetailsViewModel}" Visibility="{Binding CanControl, Converter={StaticResource BoolToVisibilityConverter}}" Margin="4 4 0 0" />
		</Grid>
	</Grid>
</UserControl>